<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shiny Events</title>
  <meta name="description" content="–ö–æ–Ω—Ü–µ—Ä—Ç–∏—Ç–µ –Ω–∞ Shiny Events ‚Äî –≥—Ä–∞—Ñ–∏–∫, –Ω–æ–≤–∏–Ω–∏ –∏ –ø—É—à –∏–∑–≤–µ—Å—Ç–∏—è.">

  <!-- üñº Open Graph –∑–∞ –ª–∏–Ω–∫ –ø—Ä–µ–≤—é -->
  <meta property="og:title" content="Shiny Events">
  <meta property="og:description" content="–ö–æ–Ω—Ü–µ—Ä—Ç–∏—Ç–µ –Ω–∞ Shiny Events ‚Äî –≥—Ä–∞—Ñ–∏–∫, –Ω–æ–≤–∏–Ω–∏ –∏ –ø—É—à –∏–∑–≤–µ—Å—Ç–∏—è.">
  <meta property="og:image" content="https://shiny-events.github.io/shiny_events_hor.png">
  <meta property="og:url" content="https://shiny-events.github.io/">
  <meta property="og:type" content="website">

  <!-- üê¶ Twitter card (–ø–æ –∂–µ–ª–∞–Ω–∏–µ) -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Shiny Events">
  <meta name="twitter:description" content="–ö–æ–Ω—Ü–µ—Ä—Ç–∏—Ç–µ –Ω–∞ Shiny Events ‚Äî –≥—Ä–∞—Ñ–∏–∫, –Ω–æ–≤–∏–Ω–∏ –∏ –ø—É—à –∏–∑–≤–µ—Å—Ç–∏—è.">
  <meta name="twitter:image" content="https://shiny-events.github.io/shiny_events_hor.png">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#111111">
  <style>
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:#0f0f10;color:#eee}
    header{padding:24px 16px;border-bottom:1px solid #222;position:sticky;top:0;background:#0f0f10}
    .container{max-width:960px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{padding:16px;border:1px solid #222;border-radius:16px}
    button{padding:12px 16px;border-radius:12px;border:1px solid #333;background:#1a1a1b;color:#eee;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    a{color:inherit}
    iframe{width:100%;min-height:600px;border:0;border-radius:12px}
    footer{padding:24px 16px;color:#999;border-top:1px solid #222}
    .tip{font-size:.9rem;color:#bbb}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1 style="margin:0">Shiny Events</h1>
      <div class="tip">PWA —Å–∞–π—Ç ‚Äî –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –æ—Ç –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (Add to Home Screen).</div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <section class="card">
        <h2 style="margin-top:0">–ê–±–æ–Ω–∏—Ä–∞–π —Å–µ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è</h2>
        <p>–ù–∞—Ç–∏—Å–Ω–∏ –±—É—Ç–æ–Ω–∞, –∑–∞ –¥–∞ –ø–æ–ª—É—á–∞–≤–∞—à web push –ø—Ä–∏ –Ω–æ–≤ –∫–æ–Ω—Ü–µ—Ä—Ç.</p>
        <button id="subscribeBtn">–ê–±–æ–Ω–∏—Ä–∞–π –º–µ</button>
        <p class="tip">–ù–∞ iPhone: –¥–æ–±–∞–≤–∏ —Å–∞–π—Ç–∞ –Ω–∞ Home Screen –∏ –æ—Ç–≤–æ—Ä–∏ –æ—Ç –∏–∫–æ–Ω–∞—Ç–∞, –∑–∞ –¥–∞ —Ä–∞–∑—Ä–µ—à–∏—à –∏–∑–≤–µ—Å—Ç–∏—è.</p>
      </section>

      <section class="card">
        <h2 style="margin-top:0">–ö–∞–ª–µ–Ω–¥–∞—Ä —Å –∫–æ–Ω—Ü–µ—Ä—Ç–∏</h2>
        <iframe
          src="https://calendar.google.com/calendar/embed?src=9bac831570f5d3e35b1261209d5771dc6619c4ce71f09c9e2724d19973541915%40group.calendar.google.com&ctz=Europe%2FSofia"
          loading="lazy"></iframe>
        <p class="tip">
          <a href="https://calendar.google.com/calendar/ical/9bac831570f5d3e35b1261209d5771dc6619c4ce71f09c9e2724d19973541915%40group.calendar.google.com/public/basic.ics" download>
            –°–≤–∞–ª–∏ .ics
          </a>
        </p>
      </section>

      <section class="card">
        <h2 style="margin-top:0">–°—ä–±–∏—Ç–∏—è (–ø—Ä–∏–º–µ—Ä–Ω–∏)</h2>
        <div id="events"></div>
      </section>
    </div>
  </main>

  <footer class="container">
    <div>¬© <span id="year"></span> Shiny Events</div>
  </footer>

  <!-- OneSignal SDK v16 -->
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js');
      });
    }

    fetch('./events.json').then(r => r.json()).then(list => {
      const wrap = document.getElementById('events');
      wrap.innerHTML = list.map(ev => {
        return `<div style="margin:8px 0;padding:12px;border:1px solid #333;border-radius:12px">
          <strong>${ev.title}</strong><br>
          ${new Date(ev.date).toLocaleString('bg-BG')} ‚Äî ${ev.venue}
        </div>`;
      }).join('');
    }).catch(() => {
      document.getElementById('events').textContent = '–ù—è–º–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏ —Å—ä–±–∏—Ç–∏—è (—Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–π events.json).';
    });

    document.getElementById('year').textContent = new Date().getFullYear();

    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "347845c9-a96f-49a5-8505-724accf392b3",
        notifyButton: { enable: false }
      });

      const btn = document.getElementById('subscribeBtn');
      async function updateBtn() {
        const state = await OneSignal.User.PushSubscription.optedIn();
        btn.textContent = state ? "–ê–±–æ–Ω–∏—Ä–∞–Ω —Å–∏ ‚úî" : "–ê–±–æ–Ω–∏—Ä–∞–π –º–µ";
        btn.disabled = state;
      }

      btn.addEventListener('click', async () => {
        try {
          await OneSignal.Notifications.requestPermission();
        } catch (e) {
          console.warn("Permission error:", e);
        }
        updateBtn();
      });

      updateBtn();
    });
  </script>
</body>
</html>
