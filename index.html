<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shiny Events</title>
  <meta name="description" content="–ö–æ–Ω—Ü–µ—Ä—Ç–∏—Ç–µ –Ω–∞ Shiny Events ‚Äî –≥—Ä–∞—Ñ–∏–∫, –Ω–æ–≤–∏–Ω–∏ –∏ –ø—É—à –∏–∑–≤–µ—Å—Ç–∏—è.">

  <!-- üñº Open Graph -->
  <meta property="og:title" content="Shiny Events">
  <meta property="og:description" content="–ö–æ–Ω—Ü–µ—Ä—Ç–∏—Ç–µ –Ω–∞ Shiny Events ‚Äî –≥—Ä–∞—Ñ–∏–∫, –Ω–æ–≤–∏–Ω–∏ –∏ –ø—É—à –∏–∑–≤–µ—Å—Ç–∏—è.">
  <meta property="og:image" content="https://shiny-events.github.io/shiny_events_hor.png">
  <meta property="og:url" content="https://shiny-events.github.io/">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Shiny Events">
  <meta name="twitter:description" content="–ö–æ–Ω—Ü–µ—Ä—Ç–∏—Ç–µ –Ω–∞ Shiny Events ‚Äî –≥—Ä–∞—Ñ–∏–∫, –Ω–æ–≤–∏–Ω–∏ –∏ –ø—É—à –∏–∑–≤–µ—Å—Ç–∏—è.">
  <meta name="twitter:image" content="https://shiny-events.github.io/shiny_events_hor.png">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#111111">

  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:#0f0f10;color:#eee}
    header{padding:24px 16px;border-bottom:1px solid #222;position:sticky;top:0;background:#0f0f10;text-align:center}
    header img{max-width:260px;height:auto;display:block;margin:0 auto 8px auto}
    .container{max-width:960px;margin:0 auto;padding:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{padding:16px;border:1px solid #222;border-radius:16px}
    button{padding:12px 16px;border-radius:12px;border:1px solid #333;background:#1a1a1b;color:#eee;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    a{color:inherit;text-decoration:none}
    iframe{width:100%;min-height:600px;border:0;border-radius:12px}

    footer{padding:24px 16px;color:#999;border-top:1px solid #222;text-align:center}
    .tip{font-size:.9rem;color:#bbb}

    #smartHint {
      display:none;
      background:#222;
      color:#eee;
      padding:16px;
      border-radius:16px;
      margin-bottom:16px;
      text-align:center;
      font-size:.95rem;
      line-height:1.5;
    }

    .socials {
      display:flex;
      justify-content:center;
      gap:16px;
      margin-top:12px;
    }
    .socials a {
      width:44px;
      height:44px;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#1a1a1b;
      border-radius:50%;
      color:#eee;
      font-size:1.3rem;
      transition:background .2s ease, transform .2s ease;
    }
    .socials a:hover {
      background:#333;
      transform:scale(1.1);
    }
  </style>
</head>
<body>
  <header>
    <img src="https://shiny-events.github.io/shiny_events_hor.png" alt="Shiny Events">
    <div class="tip">PWA —Å–∞–π—Ç ‚Äî –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –æ—Ç –º–µ–Ω—é—Ç–æ –Ω–∞ –±—Ä–∞—É–∑—ä—Ä–∞ (Add to Home Screen).</div>
  </header>

  <main class="container">
    <div class="grid">

      <!-- üß† –£–º–µ–Ω –±–∞–Ω–µ—Ä -->
      <div id="smartHint"></div>

      <section class="card">
        <h2 style="margin-top:0">–ê–±–æ–Ω–∏—Ä–∞–π —Å–µ –∑–∞ –∏–∑–≤–µ—Å—Ç–∏—è</h2>
        <p>–ù–∞—Ç–∏—Å–Ω–∏ –±—É—Ç–æ–Ω–∞, –∑–∞ –¥–∞ –ø–æ–ª—É—á–∞–≤–∞—à web push –ø—Ä–∏ –Ω–æ–≤ –∫–æ–Ω—Ü–µ—Ä—Ç.</p>
        <button id="subscribeBtn">–ê–±–æ–Ω–∏—Ä–∞–π –º–µ</button>
        <p class="tip">–ù–∞ iPhone: –¥–æ–±–∞–≤–∏ —Å–∞–π—Ç–∞ –Ω–∞ Home Screen –∏ –æ—Ç–≤–æ—Ä–∏ –æ—Ç –∏–∫–æ–Ω–∞—Ç–∞, –∑–∞ –¥–∞ —Ä–∞–∑—Ä–µ—à–∏—à –∏–∑–≤–µ—Å—Ç–∏—è.</p>
      </section>

      <section class="card">
        <h2 style="margin-top:0">–ö–∞–ª–µ–Ω–¥–∞—Ä —Å –∫–æ–Ω—Ü–µ—Ä—Ç–∏</h2>
        <iframe
          src="https://calendar.google.com/calendar/embed?src=9bac831570f5d3e35b1261209d5771dc6619c4ce71f09c9e2724d19973541915%40group.calendar.google.com&ctz=Europe%2FSofia"
          loading="lazy"></iframe>
        <p class="tip">
          <a href="https://calendar.google.com/calendar/ical/9bac831570f5d3e35b1261209d5771dc6619c4ce71f09c9e2724d19973541915%40group.calendar.google.com/public/basic.ics" download>
            –°–≤–∞–ª–∏ .ics
          </a>
        </p>
      </section>

      <section class="card">
        <h2 style="margin-top:0">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏ —Å—ä–±–∏—Ç–∏—è</h2>
        <div id="events">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>
      </section>
    </div>
  </main>

  <footer class="container">
    <div>¬© <span id="year"></span> Shiny Events</div>
    <div class="socials">
      <a href="https://www.instagram.com/shiny.events.united/" target="_blank" title="Instagram">üì∏</a>
      <a href="https://www.facebook.com/profile.php?id=61563174167404" target="_blank" title="Facebook">üìò</a>
      <a href="mailto:shiny.events.united@gmail.com" title="Email">üìß</a>
    </div>
  </footer>

  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js');
      });
    }

    document.getElementById('year').textContent = new Date().getFullYear();

    // üß† –î–µ—Ç–µ–∫—Ç–æ—Ä: iOS –∏–ª–∏ In-App
    const ua = navigator.userAgent || navigator.vendor || window.opera;
    const isIOS = /iphone|ipad|ipod/i.test(ua);
    const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    const isInApp = /FBAN|FBAV|Instagram|Messenger/i.test(ua);

    const hint = document.getElementById('smartHint');
    const subscribeBtn = document.getElementById('subscribeBtn');

    if (isInApp) {
      hint.innerHTML = `
        ‚ö° <strong>–û—Ç–≤–∞—Ä—è—à –æ—Ç Instagram / Messenger?</strong><br>
        –í–≥—Ä–∞–¥–µ–Ω–∏—Ç–µ –±—Ä–∞—É–∑—ä—Ä–∏ –Ω–µ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –∏–∑–≤–µ—Å—Ç–∏—è –∏ –∏–Ω—Å—Ç–∞–ª–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ.<br><br>
        üìç <strong>–ö–∞–∫–≤–æ –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏—à:</strong><br>
        ‚Ä¢ iPhone: –≥–æ—Ä–µ –≤–¥—è—Å–Ω–æ ‚Üí <strong>‚Ä¢‚Ä¢‚Ä¢</strong> ‚Üí <strong>Open in Safari</strong><br>
        ‚Ä¢ Android: –≥–æ—Ä–µ –≤–¥—è—Å–Ω–æ ‚Üí <strong>‚ãÆ</strong> ‚Üí <strong>Open in Chrome</strong>
      `;
      hint.style.display = 'block';
      subscribeBtn.style.display = 'none';
    } else if (isIOS && !isStandalone) {
      hint.innerHTML = `
        üì≤ <strong>iPhone –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª?</strong><br>
        –ó–∞ –¥–∞ –ø–æ–ª—É—á–∞–≤–∞—à –∏–∑–≤–µ—Å—Ç–∏—è:<br>
        1Ô∏è‚É£ –ù–∞—Ç–∏—Å–Ω–∏ <strong>Share</strong> ‚Üí 2Ô∏è‚É£ <strong>Add to Home Screen</strong><br>
        3Ô∏è‚É£ –û—Ç–≤–æ—Ä–∏ –æ—Ç –Ω–æ–≤–∞—Ç–∞ –∏–∫–æ–Ω–∞ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ <strong>‚Äû–ê–±–æ–Ω–∏—Ä–∞–π –º–µ‚Äú</strong>
      `;
      hint.style.display = 'block';
      subscribeBtn.style.display = 'none';
    }

    // üîî OneSignal
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "347845c9-a96f-49a5-8505-724accf392b3",
        notifyButton: { enable: false }
      });

      async function updateBtn() {
        const state = await OneSignal.User.PushSubscription.optedIn();
        subscribeBtn.textContent = state ? "–ê–±–æ–Ω–∏—Ä–∞–Ω —Å–∏ ‚úî" : "–ê–±–æ–Ω–∏—Ä–∞–π –º–µ";
        subscribeBtn.disabled = state;
      }

      subscribeBtn.addEventListener('click', async () => {
        try { await OneSignal.Notifications.requestPermission(); }
        catch (e) { console.warn("Permission error:", e); }
        updateBtn();
      });

      updateBtn();
    });

    // üìÖ Google Calendar
    const CALENDAR_ID = "9bac831570f5d3e35b1261209d5771dc6619c4ce71f09c9e2724d19973541915@group.calendar.google.com";
    const API_KEY = "AIzaSyDo-KQjITyYdgKlcyULonqtHVUvx7udb1k";

    async function loadCalendarEvents() {
      const now = new Date().toISOString();
      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events?key=${API_KEY}&timeMin=${now}&singleEvents=true&orderBy=startTime`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const wrap = document.getElementById('events');
        if (!data.items || !data.items.length) {
          wrap.textContent = "–ù—è–º–∞ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏ —Å—ä–±–∏—Ç–∏—è.";
          return;
        }
        wrap.innerHTML = data.items.map(ev => {
          const start = ev.start.dateTime || ev.start.date;
          const venue = ev.location || "‚Äî";
          return `<div style="margin:8px 0;padding:12px;border:1px solid #333;border-radius:12px">
              <strong>${ev.summary}</strong><br>
              ${new Date(start).toLocaleString('bg-BG')} ‚Äî ${venue}
            </div>`;
        }).join('');
      } catch (err) {
        console.error(err);
        document.getElementById('events').textContent = "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—ä–±–∏—Ç–∏—è—Ç–∞.";
      }
    }
    loadCalendarEvents();
  </script>
</body>
</html>
